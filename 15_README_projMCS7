# 15. ProjMCS7 - Peak Matrix creation and motif annotations

15_projMCS7.R

Peak enrichment
- getPeakSet
- addPeakMatrix
- Creates projMCS7
- Marker peak cutOff = "FDR <= 0.1 & abs(Log2FC) >= 0.5"
- Plots heatmap of all clusters, file: Peak-Marker-Heatmap_2024-08-07.pdf
- Plots MA and Volcano plots, file: C18-PeakMarkers-MA-Volcano_2024-08-07.pdf
- Plots Browser tracks, file: C18-Tracks-With-PeakFeatures_2024-08-07.pdf
- Pairwise testing between groups; Plots MA & Volcano plots
    - File: C18-vs-C22-Markers-MA-Volcano_2024-08-07.pdf
- addMotifAnnotations; motifSet = "cisbp"
- peakAnnoEnrichment; cutOff = "FDR <= 0.1 & Log2FC >= 0.5"(C18)/Log2FC <= -0.5"(C22)"
- Creates a dataframe object containing the motif names, corrected p-values, and significance rank. 
- Plots rank-sorted TF motifs, colored by significance of enrichment
    - File: C18-vs-C22-Markers-Motifs-Enriched_2024-08-07.pdf
- Plots an enrichment heatmap, file: Motifs-Enriched-Marker-Heatmap_2024-08-07.pdf
- addArchRAnnotations
- Plots top C18 (Log2FC >= 0.5) and C22 (Log2FC <= -0.5)
    - File: C18-vs-C22-Markers-Motifs-Enriched_2024-08-07.pdf
    
Motif Enrichment
- peakAnnoEnrichment; seMarker = markersPeaks, ArchRProj = projMCS7, peakAnnotation = "Motif"
    - cutOff = "FDR <= 0.1 & abs(Log2FC) >= 0.5"
    - Plots heatmap: Motifs-Enriched-Marker-Heatmap_2024-08-07.pdf
    - Code is not supported collections: EncodeTFBS, ATAC, Codex; or ChIP peakAnnotations
- addBgdPeaks; used in computing deviations. 
- addDeviationsMatrix; computes per-cell deviations across all motif annotations.
- getVarDeviations; used to access deviations & and return a ggplot object. 
    - File: Variable-Motif-Deviation-Scores_2024-08-07.pdf
- getFeatures; extracts motifs for downstreatm analysis. 
- grep; used to get just the features corresponding to z-scores. 
- Plots groups with impute weights, file: Plot-Groups-Deviations-w-Imputation_2024-08-07.pdf
- Plots z-score distributions on UMAPs.
- Cannot run code for markerRNA. 


15_normExp_projMCS7.R
- getMarkerFeatures uses PeakMatrix, groupBy clusters
    - cutOff = "FDR <= 0.1 & abs(Log2FC) >= 0.5"
- Creates Browser tracks of interesting genes 
    - groupBy Sample file: normTracksbySample-Interesting-With-PeakFeatures_2024-08-28.pdf
    - groupBy cluster file: normTracksbyClusters-Interesting-With-PeakFeatures_2024-08-28.pdf
    - groupBy treatment file: C3-normTracksbyTx-With-PeakFeatures_2024-08-28.pdf
    - Examines C18 subclusters


15_peakVSmatrix.R
- Follows code from projMCS7.R, but loops through subset clusters to make tx group pairwise comparisons
    - File ex: _Motif_FDR-0-1_2024-09-16.csv
- Creates Browser tracks for genes of interest
    - cutOff = "FDR <= 0.1 & abs(Log2FC) >= 0.5"
    - File: C18-Tracks-With-PeakFeatures_2024-08-07.pdf & Peak-C3-T1vsT3-Tracks_2024-09-16.pdf

# 15_Peak_Analysis
Compares marker peaks found in each treatment group

# 15_Pairwise-Peak_Scatterplot
Scatterplot displaying the number of DA genes by number of cells, colored by cell type

# 15_projMCS9.R
- Loops through all clusters making pairwise comparisons using peakMatrix
    - cutOff = "FDR <= 0.1 & abs(Log2FC) >=0.5"
    - File ex: cluster, "_", useGroup, "vs", bgdGroup, "_Peak9_FDR-0-1_Log2FC-0-5_2024-09-12.csv"
- addGroupCoverages; to create pseudobulk replicates.
- addReproduciblePeakSet; getPeakSet
- Creates projMCS9_5
- Loops through all clusters; adds impute weights; loops through pairwise comparisons
    - cutOff = "FDR <= 0.1 & abs(Log2FC) >=0.5"
    - File name ex: cluster, "_", useGroup, "vs", bgdGroup, "_Peak9-5_FDR-0-1_Log2FC-0-5_2024-09-13.csv
- Code repeated to create projMCS9_7; reran pairwise comparison loops. 

# 15_Motif_txComps
Combines treatment group motif spreadsheets for comparison purposes

# 15_Motif_CellType_PairwiseComps
Loops through all cell type groupings making pairwise comparisons between each cell type

# 15_Peak_Analysis_byTx
Compares genomic peaks by treatment
